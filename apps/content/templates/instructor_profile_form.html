{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}{{ title }} - Learning Platform{% endblock title %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/tagify/tagify.css' %}" />
{% endblock vendor_css %}

{% block vendor_js %}
{{ block.super }}
<script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
<script src="{% static 'vendor/libs/tagify/tagify.js' %}"></script>
{% endblock vendor_js %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">{{ title }}</h5>
        <a href="{% url 'dashboards:dashboard-teacher' %}" class="btn btn-outline-primary btn-sm">
          <i class="ti ti-arrow-left me-1"></i> Back to Dashboard
        </a>
      </div>

      <div class="card-body">
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}

          {% if form.errors %}
          <div class="alert alert-danger">
            <div class="alert-body">
              Please correct the errors below:
              <ul class="mb-0 mt-1">
                {% for field in form %}
                  {% if field.errors %}
                    {% for error in field.errors %}
                      <li>{{ field.label }}: {{ error }}</li>
                    {% endfor %}
                  {% endif %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          </div>
          {% endif %}

          <div class="row g-3">
            <!-- Profile Image -->
            <div class="col-md-3">
              <div class="d-flex flex-column align-items-center">
                {% if form.instance.profile_image %}
                <img src="{{ form.instance.profile_image.url }}" alt="Profile Preview" id="profile-preview" class="rounded-circle mb-3" style="width: 100px; height: 100px; object-fit: cover;">
                {% else %}
                <div id="profile-preview-placeholder" class="avatar avatar-lg mb-3">
                  <div class="avatar-initial rounded-circle bg-label-primary">
                    <i class="ti ti-user"></i>
                  </div>
                </div>
                <img src="" alt="Profile Preview" id="profile-preview" class="rounded-circle d-none mb-3" style="width: 100px; height: 100px; object-fit: cover;">
                {% endif %}
                
                <div class="mb-2 text-center">
                  <label for="{{ form.profile_image.id_for_label }}" class="btn btn-outline-primary btn-sm">
                    <i class="ti ti-upload me-1"></i> Upload
                  </label>
                  <input type="file" id="{{ form.profile_image.id_for_label }}" name="{{ form.profile_image.html_name }}" class="d-none" accept="image/*">
                  {% if form.profile_image.errors %}
                  <div class="invalid-feedback d-block small">{{ form.profile_image.errors.0 }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="col-md-9">
              <div class="row g-3">
                <!-- Availability Status -->
                {% if form.is_available %}
                <div class="col-md-4">
                  <div class="form-check form-switch mt-1">
                    {{ form.is_available }}
                    <label class="form-check-label" for="{{ form.is_available.id_for_label }}">
                      Available for booking
                    </label>
                  </div>
                </div>
                {% endif %}

                <!-- Teaching Level -->
                <div class="col-md-4">
                  <label for="teaching_level" class="form-label">Teaching Level</label>
                  <select class="form-select form-select-sm" name="teaching_level" id="teaching_level">
                    <option value="">Select Level</option>
                    <option value="A1">Beginner</option>
                    <option value="A2">Elementary</option>
                    <option value="B1">Intermediate</option>
                    <option value="B2">Upper Intermediate</option>
                    <option value="C1">Advanced</option>
                    <option value="C2">Proficient</option>
                  </select>
                </div>

                <!-- Language Dropdown -->
                <div class="col-md-4">
                  <label for="language" class="form-label">Teaching Language</label>
                  <select class="form-select form-select-sm" name="language" id="language">
                    <option value="">Select Language</option>
                    <option value="english">English</option>
                    <option value="french">French</option>
                    <option value="spanish">Spanish</option>
                    <option value="swahili">Swahili</option>
                    <option value="german">German</option>
                    <option value="chinese">Chinese</option>
                    <option value="arabic">Arabic</option>
                  </select>
                </div>

                <!-- Specialties Selection -->
                <div class="col-md-12">
                  <label for="specialty" class="form-label">Teaching Specialty</label>
                  <select class="form-select form-select-sm" name="specialty" id="specialty">
                    <option value="">Select Specialty</option>
                    <option value="grammar">Grammar</option>
                    <option value="conversation">Conversation</option>
                    <option value="business">Business Language</option>
                    <option value="exam">Exam Preparation</option>
                    <option value="literature">Literature</option>
                    <option value="pronunciation">Pronunciation</option>
                    <option value="writing">Writing</option>
                    <option value="academic">Academic</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Bio -->
            <div class="col-md-6">
              <label for="{{ form.bio.id_for_label }}" class="form-label">Professional Bio</label>
              <textarea id="{{ form.bio.id_for_label }}" name="{{ form.bio.html_name }}" class="form-control" rows="3" placeholder="Briefly introduce yourself and your qualifications">{{ form.bio.value|default:'' }}</textarea>
              {% if form.bio.errors %}
              <div class="invalid-feedback d-block">{{ form.bio.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Teaching Style -->
            <div class="col-md-6">
              <label for="{{ form.teaching_style.id_for_label }}" class="form-label">Teaching Style</label>
              <textarea id="{{ form.teaching_style.id_for_label }}" name="{{ form.teaching_style.html_name }}" class="form-control" rows="3" placeholder="Describe your teaching approach">{{ form.teaching_style.value|default:'' }}</textarea>
              {% if form.teaching_style.errors %}
              <div class="invalid-feedback d-block">{{ form.teaching_style.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Submit Buttons -->
            <div class="col-12 d-flex justify-content-end gap-2 mt-3">
              <a href="{% url 'dashboards:dashboard-teacher' %}" class="btn btn-outline-secondary btn-sm">Cancel</a>
              <button type="submit" class="btn btn-primary btn-sm">{{ submit_text|default:"Save Profile" }}</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block page_js_extra %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Image preview
    const profileInput = document.getElementById('{{ form.profile_image.id_for_label }}');
    const profilePreview = document.getElementById('profile-preview');
    const profilePlaceholder = document.getElementById('profile-preview-placeholder');
    
    if (profileInput && profilePreview) {
      profileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            profilePreview.setAttribute('src', e.target.result);
            profilePreview.classList.remove('d-none');
            if (profilePlaceholder) {
              profilePlaceholder.classList.add('d-none');
            }
          };
          reader.readAsDataURL(this.files[0]);
        }
      });
    }
  });
</script>
{% endblock %}