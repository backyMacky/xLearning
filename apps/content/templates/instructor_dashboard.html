{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Instructor Dashboard - Learning Platform{% endblock title %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/apex-charts/apex-charts.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/fullcalendar/fullcalendar.css' %}" />
{% endblock vendor_css %}

{% block vendor_js %}
{{ block.super }}
<script src="{% static 'vendor/libs/apex-charts/apexcharts.js' %}"></script>
<script src="{% static 'vendor/libs/fullcalendar/fullcalendar.js' %}"></script>
<script src="{% static 'vendor/libs/moment/moment.js' %}"></script>
{% endblock vendor_js %}

{% block content %}
<!-- Information Alert for Non-Teachers -->
{% if not has_instructor_profile %}
<div class="card mb-4">
  <div class="card-body text-center py-5">
    <div class="avatar avatar-lg mx-auto mb-3">
      <span class="avatar-initial rounded-circle bg-label-primary">
        <i class="ti ti-user-plus"></i>
      </span>
    </div>
    <h4 class="mb-2">Become an Instructor</h4>
    <p class="mb-4">Create your instructor profile to start teaching and hosting sessions on the platform.</p>
    <a href="{% url 'content:create_instructor_profile' %}" class="btn btn-primary">Create Instructor Profile</a>
  </div>
</div>

{% else %}
<!-- Instructor Dashboard Content -->
<!-- Stats Overview Cards -->
<div class="row">
  <div class="col-lg-3 col-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="content-left">
            <span class="fw-semibold d-block mb-1">Total Sessions</span>
            <div class="d-flex align-items-end">
              <h3 class="card-title mb-0 me-2">{{ total_sessions|default:"0" }}</h3>
              <small class="text-{% if session_growth >= 0 %}success{% else %}danger{% endif %}">{{ session_growth|default:"0" }}%</small>
            </div>
            <small class="text-muted">Private + Group Sessions</small>
          </div>
          <div class="avatar">
            <span class="avatar-initial rounded bg-label-primary">
              <i class="ti ti-calendar-stats ti-sm"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="content-left">
            <span class="fw-semibold d-block mb-1">Completed</span>
            <div class="d-flex align-items-end">
              <h3 class="card-title mb-0 me-2">{{ completed_sessions|default:"0" }}</h3>
              <small class="text-success">{{ completed_ratio|default:"0" }}%</small>
            </div>
            <small class="text-muted">Completion rate</small>
          </div>
          <div class="avatar">
            <span class="avatar-initial rounded bg-label-success">
              <i class="ti ti-check ti-sm"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="content-left">
            <span class="fw-semibold d-block mb-1">Cancelled</span>
            <div class="d-flex align-items-end">
              <h3 class="card-title mb-0 me-2">{{ cancelled_sessions|default:"0" }}</h3>
              <small class="text-{% if cancellation_ratio < 15 %}success{% elif cancellation_ratio < 30 %}warning{% else %}danger{% endif %}">{{ cancellation_ratio|default:"0" }}%</small>
            </div>
            <small class="text-muted">Cancellation rate</small>
          </div>
          <div class="avatar">
            <span class="avatar-initial rounded bg-label-danger">
              <i class="ti ti-x ti-sm"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="content-left">
            <span class="fw-semibold d-block mb-1">Total Students</span>
            <div class="d-flex align-items-end">
              <h3 class="card-title mb-0 me-2">{{ total_students|default:"0" }}</h3>
              <small class="text-success">+{{ student_growth|default:"0" }}%</small>
            </div>
            <small class="text-muted">Across all sessions</small>
          </div>
          <div class="avatar">
            <span class="avatar-initial rounded bg-label-info">
              <i class="ti ti-users ti-sm"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-3">Quick Actions</h5>
        <div class="row g-2">
          <div class="col-md-3 col-6">
            <a href="{% url 'content:create_private_session' %}" class="btn btn-outline-primary d-flex flex-column align-items-center justify-content-center p-3 h-100 w-100">
              <i class="ti ti-user-plus ti-lg mb-2"></i>
              <span>Create Private Session</span>
            </a>
          </div>
          <div class="col-md-3 col-6">
            <a href="{% url 'content:create_group_session' %}" class="btn btn-outline-primary d-flex flex-column align-items-center justify-content-center p-3 h-100 w-100">
              <i class="ti ti-users-plus ti-lg mb-2"></i>
              <span>Create Group Session</span>
            </a>
          </div>
          <div class="col-md-3 col-6">
            <a href="{% url 'content:update_instructor_profile' %}" class="btn btn-outline-primary d-flex flex-column align-items-center justify-content-center p-3 h-100 w-100">
              <i class="ti ti-edit-circle ti-lg mb-2"></i>
              <span>Edit Profile</span>
            </a>
          </div>
          <div class="col-md-3 col-6">
            <a href="{% url 'content:instructor_detail' username=request.user.username %}" class="btn btn-outline-primary d-flex flex-column align-items-center justify-content-center p-3 h-100 w-100">
              <i class="ti ti-eye ti-lg mb-2"></i>
              <span>View Public Profile</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content Row -->
<div class="row">
  <!-- Left Column -->
  <div class="col-xl-8 mb-4">
    <!-- Upcoming Sessions Calendar -->
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Upcoming Sessions</h5>
        <div>
          <a href="{% url 'content:create_private_session' %}" class="btn btn-primary btn-sm me-1">
            <i class="ti ti-plus me-1"></i> Private Slot
          </a>
          <a href="{% url 'content:create_group_session' %}" class="btn btn-outline-primary btn-sm">
            <i class="ti ti-plus me-1"></i> Group Session
          </a>
        </div>
      </div>
      <div class="card-body p-0">
        <div id="instructor-calendar" style="height: 450px;"></div>
      </div>
    </div>
    
    <!-- Session Management Tabs -->
    <div class="card">
      <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="active-tab" data-bs-toggle="tab" data-bs-target="#active-sessions" type="button" role="tab" aria-controls="active-sessions" aria-selected="true">
              Active Sessions
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="scheduled-tab" data-bs-toggle="tab" data-bs-target="#scheduled-sessions" type="button" role="tab" aria-controls="scheduled-sessions" aria-selected="false">
              Scheduled
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past-sessions" type="button" role="tab" aria-controls="past-sessions" aria-selected="false">
              Past Sessions
            </button>
          </li>
        </ul>
      </div>
      
      <div class="tab-content">
        <!-- Active Sessions Tab -->
        <div class="tab-pane fade show active" id="active-sessions" role="tabpanel" aria-labelledby="active-tab">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Date & Time</th>
                  <th>Student(s)</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if active_sessions %}
                  {% for session in active_sessions %}
                    <tr>
                      <td>
                        <span class="badge bg-label-{% if session.is_private %}primary{% else %}info{% endif %}">
                          {% if session.is_private %}Private{% else %}Group{% endif %}
                        </span>
                      </td>
                      <td>
                        <div class="d-flex flex-column">
                          <span>{{ session.start_time|date:"M d, Y" }}</span>
                          <small class="text-muted">{{ session.start_time|time:"H:i" }}</small>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          {% if session.is_private %}
                            {% if session.student %}
                              <div class="avatar me-2">
                                {% if session.student.profile.profile_image %}
                                  <img src="{{ session.student.profile.profile_image.url }}" alt="{{ session.student.username }}" class="rounded-circle">
                                {% else %}
                                  <div class="avatar-initial rounded-circle bg-label-secondary">
                                    <i class="ti ti-user ti-xs"></i>
                                  </div>
                                {% endif %}
                              </div>
                              <span>{{ session.student.username }}</span>
                            {% else %}
                              <span class="text-muted">Not booked</span>
                            {% endif %}
                          {% else %}
                            <div class="d-flex flex-column">
                              <div class="d-flex align-items-center">
                                <span class="me-1">{{ session.students_count }} / {{ session.max_students }}</span>
                                <div class="progress flex-grow-1" style="height: 5px; width: 60px">
                                  <div class="progress-bar bg-primary" role="progressbar" 
                                      style="width: {{ session.enrollment_percentage }}%" 
                                      aria-valuenow="{{ session.enrollment_percentage }}" 
                                      aria-valuemin="0" 
                                      aria-valuemax="100"></div>
                                </div>
                              </div>
                              <small class="text-muted">{{ session.title|truncatechars:20 }}</small>
                            </div>
                          {% endif %}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-label-success">
                          Active
                        </span>
                      </td>
                      <td>
                        <div class="d-flex gap-2">
                          <a href="{{ session.meeting_link }}" target="_blank" class="btn btn-sm btn-icon btn-primary" data-bs-toggle="tooltip" title="Join Meeting">
                            <i class="ti ti-video"></i>
                          </a>
                          <a href="#" class="btn btn-sm btn-icon btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                            <i class="ti ti-eye"></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="5" class="text-center py-3">
                      <p class="mb-0">No active sessions at the moment.</p>
                    </td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Scheduled Sessions Tab -->
        <div class="tab-pane fade" id="scheduled-sessions" role="tabpanel" aria-labelledby="scheduled-tab">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Date & Time</th>
                  <th>Status</th>
                  <th>Language & Level</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if upcoming_sessions %}
                  {% for session in upcoming_sessions %}
                    <tr>
                      <td>
                        <span class="badge bg-label-{% if session.is_private %}primary{% else %}info{% endif %}">
                          {% if session.is_private %}Private{% else %}Group{% endif %}
                        </span>
                      </td>
                      <td>
                        <div class="d-flex flex-column">
                          <span>{{ session.start_time|date:"M d, Y" }}</span>
                          <small class="text-muted">{{ session.start_time|time:"H:i" }}</small>
                        </div>
                      </td>
                      <td>
                        {% if session.is_private %}
                          <span class="badge bg-label-{% if session.status == 'available' %}warning{% elif session.status == 'booked' %}success{% else %}secondary{% endif %}">
                            {{ session.status|title }}
                          </span>
                        {% else %}
                          <div class="d-flex flex-column">
                            <span class="badge bg-label-primary mb-1">{{ session.students_count }} / {{ session.max_students }}</span>
                            <div class="progress" style="height: 5px; width: 60px">
                              <div class="progress-bar bg-primary" role="progressbar" 
                                  style="width: {{ session.enrollment_percentage }}%" 
                                  aria-valuenow="{{ session.enrollment_percentage }}" 
                                  aria-valuemin="0" 
                                  aria-valuemax="100"></div>
                            </div>
                          </div>
                        {% endif %}
                      </td>
                      <td>
                        <div class="d-flex flex-column">
                          <span class="badge bg-label-primary mb-1">{{ session.language.name }}</span>
                          <span class="badge bg-label-info">{{ session.level.name }}</span>
                        </div>
                      </td>
                      <td>
                        <div class="dropdown">
                          <button class="btn btn-sm btn-icon btn-outline-secondary" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ti ti-dots-vertical"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                              <a class="dropdown-item" href="{% if session.is_private %}{% url 'content:update_private_slot' slot_id=session.id %}{% else %}{% url 'content:update_group_session' session_id=session.id %}{% endif %}">
                                <i class="ti ti-edit me-1"></i> Edit
                              </a>
                            </li>
                            <li>
                              <a class="dropdown-item text-danger" href="{% if session.is_private %}{% url 'content:delete_private_slot' slot_id=session.id %}{% else %}{% url 'content:delete_group_session' session_id=session.id %}{% endif %}">
                                <i class="ti ti-trash me-1"></i> Cancel
                              </a>
                            </li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="5" class="text-center py-3">
                      <p class="mb-0">No upcoming scheduled sessions.</p>
                    </td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Past Sessions Tab -->
        <div class="tab-pane fade" id="past-sessions" role="tabpanel" aria-labelledby="past-tab">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Date & Time</th>
                  <th>Details</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if past_sessions %}
                  {% for session in past_sessions %}
                    <tr>
                      <td>
                        <span class="badge bg-label-{% if session.type == 'private' %}primary{% else %}info{% endif %}">
                          {{ session.type|title }}
                        </span>
                      </td>
                      <td>
                        <div class="d-flex flex-column">
                          <span>{{ session.start_time|date:"M d, Y" }}</span>
                          <small class="text-muted">{{ session.start_time|time:"H:i" }}</small>
                        </div>
                      </td>
                      <td>
                        {% if session.type == 'private' %}
                          <div class="d-flex align-items-center">
                            {% if session.student %}
                              <div class="avatar me-2">
                                {% if session.student.profile.profile_image %}
                                  <img src="{{ session.student.profile.profile_image.url }}" alt="{{ session.student.username }}" class="rounded-circle">
                                {% else %}
                                  <div class="avatar-initial rounded-circle bg-label-secondary">
                                    <i class="ti ti-user ti-xs"></i>
                                  </div>
                                {% endif %}
                              </div>
                              <span>{{ session.student.username }}</span>
                            {% else %}
                              <span class="text-muted">No student</span>
                            {% endif %}
                          </div>
                        {% else %}
                          <div class="d-flex flex-column">
                            <span>{{ session.title }}</span>
                            <small class="text-muted">{{ session.students.count }} students</small>
                          </div>
                        {% endif %}
                      </td>
                      <td>
                        <span class="badge bg-label-{{ session.status|lower|slugify }}">
                          {{ session.status|title }}
                        </span>
                      </td>
                      <td>
                        <div class="d-flex gap-2">
                          {% if session.recording_url %}
                            <a href="{{ session.recording_url }}" target="_blank" class="btn btn-sm btn-icon btn-outline-info" data-bs-toggle="tooltip" title="View Recording">
                              <i class="ti ti-player-play"></i>
                            </a>
                          {% endif %}
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="5" class="text-center py-3">
                      <p class="mb-0">No past sessions found.</p>
                    </td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Right Column -->
  <div class="col-xl-4">
    <!-- Profile Overview Card -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="d-flex align-items-center flex-grow-1">
            {% if instructor.profile_image %}
              <img src="{{ instructor.profile_image.url }}" alt="{{ request.user.username }}" class="rounded-circle me-3" style="width: 60px; height: 60px; object-fit: cover;">
            {% else %}
              <div class="avatar me-3">
                <div class="avatar-initial rounded-circle bg-label-primary">
                  <i class="ti ti-user"></i>
                </div>
              </div>
            {% endif %}
            <div>
              <h5 class="mb-0">{{ request.user.username }}</h5>
              <div class="d-flex align-items-center">
                <div class="text-warning me-2">
                  {% for i in "12345" %}
                    {% if forloop.counter <= instructor.rating %}
                      <i class="ti ti-star-filled ti-xs"></i>
                    {% else %}
                      <i class="ti ti-star ti-xs"></i>
                    {% endif %}
                  {% endfor %}
                </div>
                <small>{{ instructor.rating|default:"0" }}/5 ({{ instructor.review_count|default:"0" }} reviews)</small>
              </div>
            </div>
          </div>
          <a href="{% url 'content:update_instructor_profile' %}" class="btn btn-sm btn-icon btn-outline-primary" data-bs-toggle="tooltip" title="Edit Profile">
            <i class="ti ti-edit"></i>
          </a>
        </div>
        
        <div class="mt-3 mb-4 pb-2 border-bottom">
          {% if instructor.teaching_languages.all %}
            <div class="mb-2">
              <span class="text-muted">Languages:</span>
              <div class="d-flex flex-wrap gap-1 mt-1">
                {% for language in instructor.teaching_languages.all %}
                  <span class="badge bg-label-primary">{{ language.name }}</span>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          
          {% if instructor.specialties.all %}
            <div class="mb-2">
              <span class="text-muted">Specialties:</span>
              <div class="d-flex flex-wrap gap-1 mt-1">
                {% for specialty in instructor.specialties.all %}
                  <span class="badge bg-label-info">{{ specialty.name }}</span>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          
          <div class="mb-2">
            <span class="text-muted">Hourly Rate:</span>
            <span class="fw-semibold ms-1">${{ instructor.hourly_rate|default:"0" }}</span>
          </div>
          
          <div class="mb-2">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="availabilityToggle" {% if instructor.is_available %}checked{% endif %}>
              <label class="form-check-label" for="availabilityToggle">
                Available for booking
              </label>
            </div>
            <small class="text-muted">Last Updated: {{ instructor.updated_at|date:"M d, Y" }}</small>
          </div>
        </div>
        
        <div class="d-grid">
          <a href="{% url 'content:instructor_detail' username=request.user.username %}" class="btn btn-primary" target="_blank">
            <i class="ti ti-external-link me-1"></i> View Public Profile
          </a>
        </div>
      </div>
    </div>
    
    <!-- Recent Reviews Card -->
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Recent Reviews</h5>
        <a href="{% url 'content:instructor_reviews' username=request.user.username %}" class="btn btn-sm btn-outline-primary">View All</a>
      </div>
      <div class="card-body px-0">
        {% if recent_reviews %}
          {% for review in recent_reviews %}
            <div class="d-flex p-3 {% if not forloop.last %}border-bottom{% endif %}">
              <div class="flex-shrink-0 me-3">
                {% if review.student.profile_image %}
                  <img src="{{ review.student.profile_image.url }}" alt="{{ review.student.username }}" class="rounded-circle" width="38" height="38" style="object-fit: cover;">
                {% else %}
                  <div class="avatar">
                    <div class="avatar-initial rounded-circle bg-label-{{ forloop.counter|divisibleby:5|add:1 }}">
                      <i class="ti ti-user ti-xs"></i>
                    </div>
                  </div>
                {% endif %}
              </div>
              <div>
                <div class="d-flex align-items-center mb-1">
                  <h6 class="mb-0 me-2">{{ review.student.username }}</h6>
                  <div class="text-warning">
                    {% for i in "12345" %}
                      {% if forloop.counter <= review.rating %}
                        <i class="ti ti-star-filled ti-xs"></i>
                      {% else %}
                        <i class="ti ti-star ti-xs"></i>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
                <p class="mb-1">{{ review.comment|truncatechars:120 }}</p>
                <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-center py-4">
            <div class="avatar avatar-md mb-3 mx-auto">
              <div class="avatar-initial rounded-circle bg-label-primary">
                <i class="ti ti-message-circle-off"></i>
              </div>
            </div>
            <h6 class="mb-1">No Reviews Yet</h6>
            <p class="mb-0">Reviews from your students will appear here</p>
          </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Upcoming Sessions Card -->
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Today's Schedule</h5>
      </div>
      <div class="card-body p-0">
        <div class="timeline-vertical py-0">
          {% if today_sessions %}
            {% for session in today_sessions %}
              <div class="timeline-item pb-4 border-left-dashed">
                <span class="timeline-indicator-advanced timeline-indicator-{% if session.is_private %}primary{% else %}info{% endif %} border-0 shadow-none">
                  <i class="ti {% if session.is_private %}ti-user{% else %}ti-users{% endif %}"></i>
                </span>
                <div class="timeline-event ps-0 pb-0">
                  <div class="timeline-header">
                    <small class="text-{% if session.is_private %}primary{% else %}info{% endif %}">{{ session.start_time|time:"g:i A" }} - {{ session.end_time|time:"g:i A" }}</small>
                  </div>
                  <h6 class="mb-1">
                    {% if session.is_private %}
                      Private Session
                      {% if session.student %}
                        with {{ session.student.username }}
                      {% else %}
                        <span class="badge bg-label-warning">Available</span>
                      {% endif %}
                    {% else %}
                      {{ session.title }}
                      <span class="badge bg-label-info ms-1">Group</span>
                    {% endif %}
                  </h6>
                  <p class="mb-0">
                    {{ session.language.name }} ({{ session.level.name }})
                  </p>
                  {% if session.is_private %}
                    {% if not session.student %}
                      <span class="text-muted small">Not booked yet</span>
                    {% endif %}
                  {% else %}
                    <div class="d-flex align-items-center mt-1">
                      <small class="me-2">{{ session.students.count }}/{{ session.max_students }}</small>
                      <div class="progress flex-grow-1" style="height: 5px; width: 60px">
                        <div class="progress-bar bg-info" role="progressbar" 
                            style="width: {{ session.enrollment_percentage }}%" 
                            aria-valuenow="{{ session.enrollment_percentage }}" 
                            aria-valuemin="0" 
                            aria-valuemax="100"></div>
                      </div>
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-center py-4">
              <div class="avatar avatar-md mb-3 mx-auto">
                <div class="avatar-initial rounded-circle bg-label-primary">
                  <i class="ti ti-calendar-off"></i>
                </div>
              </div>
              <h6 class="mb-1">No Sessions Today</h6>
              <p class="mb-3">Your schedule is clear for the day</p>
              <a href="{% url 'content:create_private_session' %}" class="btn btn-sm btn-primary">
                Create New Session
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block page_js_extra %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Availability toggle switch functionality
    const availabilityToggle = document.getElementById('availabilityToggle');
    if (availabilityToggle) {
      availabilityToggle.addEventListener('change', function() {
        // In a real implementation, this would send an AJAX request to update the instructor's availability
        fetch('/api/instructor/update-availability/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
          },
          body: JSON.stringify({
            is_available: this.checked
          })
        })
        .then(response => response.json())
        .then(data => {
          // Show a success message
          console.log('Availability updated');
        })
        .catch(error => {
          console.error('Error updating availability:', error);
          // Revert the toggle if there was an error
          this.checked = !this.checked;
        });
      });
    }
    
    {% if has_instructor_profile %}
    // Initialize calendar
    const calendarEl = document.getElementById('instructor-calendar');
    if (calendarEl) {
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        nowIndicator: true,
        navLinks: true,
        businessHours: {
          daysOfWeek: [0, 1, 2, 3, 4, 5, 6],
          startTime: '08:00',
          endTime: '20:00',
        },
        editable: false,
        selectable: false,
        height: 'auto',
        events: [
          {% for slot in available_slots %}
          {
            title: 'Available',
            start: '{{ slot.start_time|date:"Y-m-d" }}T{{ slot.start_time|time:"H:i:s" }}',
            end: '{{ slot.end_time|date:"Y-m-d" }}T{{ slot.end_time|time:"H:i:s" }}',
            backgroundColor: '#E7F5FF',
            borderColor: '#5897FB',
            textColor: '#3A86FF',
            extendedProps: {
              type: 'private',
              status: 'available'
            }
          },
          {% endfor %}
          
          {% for slot in booked_slots %}
          {
            title: 'Booked - {{ slot.student.username }}',
            start: '{{ slot.start_time|date:"Y-m-d" }}T{{ slot.start_time|time:"H:i:s" }}',
            end: '{{ slot.end_time|date:"Y-m-d" }}T{{ slot.end_time|time:"H:i:s" }}',
            backgroundColor: '#D1FAE5',
            borderColor: '#10B981',
            textColor: '#047857',
            extendedProps: {
              type: 'private',
              status: 'booked'
            }
          },
          {% endfor %}
          
          {% for session in upcoming_group_sessions %}
          {
            title: 'Group - {{ session.title }}',
            start: '{{ session.start_time|date:"Y-m-d" }}T{{ session.start_time|time:"H:i:s" }}',
            end: '{{ session.end_time|date:"Y-m-d" }}T{{ session.end_time|time:"H:i:s" }}',
            backgroundColor: '#FEF3C7',
            borderColor: '#F59E0B',
            textColor: '#92400E',
            extendedProps: {
              type: 'group',
              status: '{{ session.status }}',
              students: {{ session.students.count }}
            }
          },
          {% endfor %}
        ],
        eventClick: function(info) {
          // Handle click on calendar events
          const eventType = info.event.extendedProps.type;
          const eventStatus = info.event.extendedProps.status;
          
          // In a real implementation, show a modal with event details
          console.log('Event clicked:', eventType, eventStatus);
        }
      });
      calendar.render();
    }
    {% endif %}
  });
</script>
{% endblock %}